---

- name: init cis_result value as FAIL
  set_fact:
    cis_result: true

- name: "{{ cis_rules[cis_item]['name'] }}"
  blockinfile:
    dest: /etc/ssh/sshd_config
    marker: "# {mark} cis-rhel7 5.3.15"
    block: |
      KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256
    validate: /usr/sbin/sshd -T -f %s
  check_mode: true
  ignore_errors: true
  register: result

- name: Reset cis_result value
  set_fact:
    cis_result: false
  when:
    - not result['failed']
    - result['changed']

